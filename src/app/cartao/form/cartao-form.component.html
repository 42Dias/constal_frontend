<form
  class="form"
  (ngSubmit)="doSave()"
  [formGroup]="form"
  #ngForm="ngForm"
  *ngIf="form"
>
  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.tipo.label }}</mat-label>
    <mat-select
      [formControlName]="fields.tipo.name"
      [placeholder]="fields.tipo.placeholder"
    >
      <mat-option>--</mat-option>
      <mat-option
        *ngFor="let option of fields.tipo.options"
        [value]="option.id"
      >
        {{ option.label }}
      </mat-option>
    </mat-select>
    <mat-hint *ngIf="fields.tipo.hint">
      {{ fields.tipo.hint }}
    </mat-hint>
    <mat-error>
      <app-validations
        [control]="form.get(fields.tipo.name)"
        [label]="fields.tipo.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.nomeTitular.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.nomeTitular.name"
      [placeholder]="fields.nomeTitular.placeholder"
      [required]="fields.nomeTitular.required"
    />

    <mat-hint *ngIf="fields.nomeTitular.hint">
      {{ fields.nomeTitular.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.nomeTitular.name)"
        [label]="fields.nomeTitular.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.apelido.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.apelido.name"
      [placeholder]="fields.apelido.placeholder"
      [required]="fields.apelido.required"
    />

    <mat-hint *ngIf="fields.apelido.hint">
      {{ fields.apelido.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.apelido.name)"
        [label]="fields.apelido.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.numero.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.numero.name"
      [placeholder]="fields.numero.placeholder"
      [required]="fields.numero.required"
    />

    <mat-hint *ngIf="fields.numero.hint">
      {{ fields.numero.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.numero.name)"
        [label]="fields.numero.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.cvv.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.cvv.name"
      [placeholder]="fields.cvv.placeholder"
      [required]="fields.cvv.required"
    />

    <mat-hint *ngIf="fields.cvv.hint">
      {{ fields.cvv.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.cvv.name)"
        [label]="fields.cvv.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.validade.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.validade.name"
      [placeholder]="fields.validade.placeholder"
      [required]="fields.validade.required"
    />

    <mat-hint *ngIf="fields.validade.hint">
      {{ fields.validade.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.validade.name)"
        [label]="fields.validade.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <mat-form-field floatLabel="always" appearance="outline">
    <mat-label>{{ fields.bandeira.label }}</mat-label>
    <input
      matInput
      [formControlName]="fields.bandeira.name"
      [placeholder]="fields.bandeira.placeholder"
      [required]="fields.bandeira.required"
    />

    <mat-hint *ngIf="fields.bandeira.hint">
      {{ fields.bandeira.hint }}
    </mat-hint>

    <mat-error>
      <app-validations
        [control]="form.get(fields.bandeira.name)"
        [label]="fields.bandeira.label"
      ></app-validations>
    </mat-error>
  </mat-form-field>

  <app-user-form-field
    [control]="form.get(fields.user.name)"
    [label]="fields.user.label"
    [placeholder]="fields.user.placeholder"
    [hint]="fields.user.hint"
    [required]="fields.user.required"
    [fetchFn]="fields.user.fetchFn"
    [mapperFn]="fields.user.mapperFn"
    [showCreate]="!modal"
    [submitted]="ngForm.submitted"
    mode="multiple"
  ></app-user-form-field>

  <div
    class="form-buttons"
    [class.form-buttons-modal]="modal"
  >
    <button
      mat-raised-button
      [disabled]="saveLoading"
      color="primary"
      type="submit"
    >
      <mat-icon
        inline
        fontSet="far"
        fontIcon="fa-save"
      ></mat-icon
      >&#160;
      <app-i18n key="common.save"></app-i18n>
    </button>
    <button
      mat-flat-button
      [disabled]="saveLoading"
      (click)="doReset()"
      type="button"
    >
      <mat-icon
        inline
        fontSet="fas"
        fontIcon="fa-undo"
      ></mat-icon
      >&#160;
      <app-i18n key="common.reset"></app-i18n>
    </button>

    <button
      mat-flat-button
      [disabled]="saveLoading"
      type="button"
      (click)="cancel.emit()"
    >
      <mat-icon
        inline
        fontSet="fas"
        fontIcon="fa-times"
      ></mat-icon
      >&#160;
      <app-i18n key="common.cancel"></app-i18n>
    </button>
  </div>
</form>
